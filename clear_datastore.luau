-- DataStore ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¯ãƒªã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰
-- æ³¨æ„: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æœ¬ç•ªç’°å¢ƒã®DataStoreã‚’å®Œå…¨ã«ã‚¯ãƒªã‚¢ã—ã¾ã™
-- å®Ÿè¡Œå‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãã ã•ã„

local DataStoreService = game:GetService("DataStoreService")

-- DataStoreè¨­å®šï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¨åŒã˜è¨­å®šã‚’ä½¿ç”¨ï¼‰
local DATASTORE_NAME = "MazeRankings"
local RANKING_KEY = "GlobalRankings"

print("ğŸš¨ DataStore ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¯ãƒªã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹")
print("âš ï¸  è­¦å‘Š: æœ¬ç•ªç’°å¢ƒã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨å‰Šé™¤ã—ã¾ã™")
print("ğŸ“Š DataStore: " .. DATASTORE_NAME)
print("ğŸ”‘ ã‚­ãƒ¼: " .. RANKING_KEY)

-- DataStoreã«æ¥ç¶š
local success, rankingDataStore = pcall(function()
    return DataStoreService:GetDataStore(DATASTORE_NAME)
end)

if not success then
    error("âŒ DataStoreæ¥ç¶šå¤±æ•—: " .. tostring(rankingDataStore))
end

print("âœ… DataStoreæ¥ç¶šæˆåŠŸ")

-- ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
print("ğŸ“‹ ç¾åœ¨ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªä¸­...")
local success, currentData = pcall(function()
    return rankingDataStore:GetAsync(RANKING_KEY)
end)

if success and currentData then
    print("ğŸ“Š ç¾åœ¨ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ•°: " .. #currentData .. " ã‚¨ãƒ³ãƒˆãƒª")
    print("ğŸ¥‡ ä¸Šä½3ä½:")
    for i = 1, math.min(3, #currentData) do
        local entry = currentData[i]
        local minutes = math.floor(entry.time / 60)
        local seconds = entry.time % 60
        print("  #" .. i .. ": " .. entry.name .. " - " .. string.format("%02d:%05.2f", minutes, seconds))
    end
else
    print("ğŸ“Š ç¾åœ¨ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°: ãƒ‡ãƒ¼ã‚¿ãªã—ã¾ãŸã¯èª­ã¿è¾¼ã¿å¤±æ•—")
end

-- 5ç§’å¾…æ©Ÿï¼ˆå®Ÿè¡Œè€…ãŒå†…å®¹ã‚’ç¢ºèªã™ã‚‹æ™‚é–“ï¼‰
print("â° 5ç§’å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™...")
print("â° ä»Šã™ãä¸­æ­¢ã—ãŸã„å ´åˆã¯Studioã‚’åœæ­¢ã—ã¦ãã ã•ã„")
wait(5)

-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
print("ğŸ—‘ï¸ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...")
local success, error = pcall(function()
    -- ç©ºã®é…åˆ—ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ã
    rankingDataStore:SetAsync(RANKING_KEY, {})
end)

if success then
    print("âœ… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ")
    print("ğŸ“Š æ–°ã—ã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°: ç©ºï¼ˆ0ã‚¨ãƒ³ãƒˆãƒªï¼‰")
else
    error("âŒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¯ãƒªã‚¢å¤±æ•—: " .. tostring(error))
end

-- å‰Šé™¤ç¢ºèª
print("ğŸ” å‰Šé™¤ç¢ºèªä¸­...")
wait(2)

local success, verifyData = pcall(function()
    return rankingDataStore:GetAsync(RANKING_KEY)
end)

if success then
    local count = verifyData and #verifyData or 0
    print("ğŸ“Š ç¢ºèªçµæœ: " .. count .. " ã‚¨ãƒ³ãƒˆãƒª")
    
    if count == 0 then
        print("âœ… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªã‚¢ãŒå®Œäº†ã—ã¾ã—ãŸ")
        print("ğŸ® ã‚²ãƒ¼ãƒ ã‚’å†èµ·å‹•ã™ã‚‹ã¨ç©ºã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™")
    else
        print("âš ï¸ è­¦å‘Š: ã¾ã  " .. count .. " ã‚¨ãƒ³ãƒˆãƒªãŒæ®‹ã£ã¦ã„ã¾ã™")
    end
else
    print("âš ï¸ å‰Šé™¤ç¢ºèªã«å¤±æ•—ã—ã¾ã—ãŸ: " .. tostring(verifyData))
end

print("ğŸ DataStoreã‚¯ãƒªã‚¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Œäº†")

-- ä½¿ç”¨æ–¹æ³•ã®èª¬æ˜
print("")
print("ğŸ“– ä½¿ç”¨æ–¹æ³•:")
print("1. Roblox Studio ã§ Game Settings â†’ Security â†’ Enable API Services ã‚’ãƒã‚§ãƒƒã‚¯")
print("2. ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ ServerScriptService ã«é…ç½®")
print("3. Studio ã§ã‚²ãƒ¼ãƒ ã‚’ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆF5ï¼‰")
print("4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¦DataStoreã‚’ã‚¯ãƒªã‚¢")
print("5. å®Œäº†å¾Œã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤")