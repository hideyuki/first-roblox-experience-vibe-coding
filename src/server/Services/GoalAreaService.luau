-- Kanata Maze ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæ‹¡å¼µç‰ˆï¼‰
local GoalAreaService = {}

local workspace = game:GetService("Workspace")

-- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
local goalAreaInitialized = false

-- æ‹¡å¼µã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢æ§‹ç¯‰
local function buildExpandedGoalArea(mazeGame)
    -- æ—¢å­˜ã®ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚’å‰Šé™¤
    local existingGoalArea = mazeGame:FindFirstChild("GoalArea")
    if existingGoalArea then
        existingGoalArea:Destroy()
    end
    
    -- æ–°ã—ã„æ‹¡å¼µã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ãƒ•ã‚©ãƒ«ãƒ€
    local goalFolder = Instance.new("Folder")
    goalFolder.Name = "GoalArea"
    goalFolder.Parent = mazeGame
    
    -- æ‹¡å¼µã•ã‚ŒãŸã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®åºŠ
    local goalFloor = Instance.new("Part")
    goalFloor.Name = "GoalFloor"
    goalFloor.Size = Vector3.new(80, 1, 60)  -- 80x60ã‚¹ã‚¿ãƒƒãƒ‰ã«æ‹¡å¼µ
    goalFloor.Position = Vector3.new(0, 0, 115)  -- z=85ã‹ã‚‰145ã¾ã§ã‚«ãƒãƒ¼
    goalFloor.Anchored = true
    goalFloor.Material = Enum.Material.Concrete
    goalFloor.BrickColor = BrickColor.new("Bright red")
    goalFloor.Parent = goalFolder
    
    -- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®å£ï¼ˆæ‹¡å¼µç‰ˆï¼‰
    local goalWalls = {
        -- å·¦å£
        {Vector3.new(1, 10, 60), Vector3.new(-40.5, 5, 115)},
        -- å³å£  
        {Vector3.new(1, 10, 60), Vector3.new(40.5, 5, 115)},
        -- å¥¥å£
        {Vector3.new(80, 10, 1), Vector3.new(0, 5, 145.5)},
        -- æ‰‹å‰å£ï¼ˆã‚´ãƒ¼ãƒ«ã‚²ãƒ¼ãƒˆå‘¨è¾ºã€å·¦å³ã«åˆ†å‰²ï¼‰
        {Vector3.new(35, 10, 1), Vector3.new(-22.5, 5, 84.5)},  -- å·¦å´
        {Vector3.new(35, 10, 1), Vector3.new(22.5, 5, 84.5)}    -- å³å´
    }
    
    for i, wall in ipairs(goalWalls) do
        local wallPart = Instance.new("Part")
        wallPart.Name = "GoalWall" .. i
        wallPart.Size = wall[1]
        wallPart.Position = wall[2]
        wallPart.Anchored = true
        wallPart.Material = Enum.Material.Brick
        wallPart.BrickColor = BrickColor.new("Dark stone grey")
        wallPart.Parent = goalFolder
    end
    
    -- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰å°åº§ã®ä½œæˆ
    local rankingPedestal = Instance.new("Part")
    rankingPedestal.Name = "RankingPedestal"
    rankingPedestal.Size = Vector3.new(22, 2, 4)  -- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ç”¨ã®å°åº§
    rankingPedestal.Position = Vector3.new(0, 1, 130)  -- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ä¸­å¤®å¥¥
    rankingPedestal.Anchored = true
    rankingPedestal.Material = Enum.Material.Marble
    rankingPedestal.BrickColor = BrickColor.new("Institutional white")
    rankingPedestal.Parent = goalFolder
    
    -- ãƒ¯ãƒ¼ãƒ—ã‚¾ãƒ¼ãƒ³ç”¨ã®ã‚¨ãƒªã‚¢
    local warpArea = Instance.new("Part")
    warpArea.Name = "WarpArea"
    warpArea.Size = Vector3.new(20, 0.1, 20)  -- ãƒ¯ãƒ¼ãƒ—ç”¨ã®åºŠãƒãƒ¼ã‚­ãƒ³ã‚°
    warpArea.Position = Vector3.new(0, 0.55, 140)  -- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒœãƒ¼ãƒ‰ã®å¾Œã‚
    warpArea.Anchored = true
    warpArea.Material = Enum.Material.Neon
    warpArea.BrickColor = BrickColor.new("Bright blue")
    warpArea.Transparency = 0.7
    warpArea.Parent = goalFolder
    
    -- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®è£…é£¾
    local celebrationArch = Instance.new("Part")
    celebrationArch.Name = "CelebrationArch"
    celebrationArch.Size = Vector3.new(25, 12, 3)
    celebrationArch.Position = Vector3.new(0, 6, 100)  -- ã‚¨ãƒªã‚¢å…¥å£
    celebrationArch.Anchored = true
    celebrationArch.Material = Enum.Material.Marble
    celebrationArch.BrickColor = BrickColor.new("Bright yellow")
    celebrationArch.Parent = goalFolder
    
    -- ã‚¢ãƒ¼ãƒã®ãƒ†ã‚­ã‚¹ãƒˆ
    local archGui = Instance.new("SurfaceGui")
    archGui.Name = "ArchGui"
    archGui.Face = Enum.NormalId.Front
    archGui.Parent = celebrationArch
    
    local archLabel = Instance.new("TextLabel")
    archLabel.Name = "ArchLabel"
    archLabel.Size = UDim2.new(1, 0, 1, 0)
    archLabel.BackgroundTransparency = 1
    archLabel.Text = "ğŸ‰ CONGRATULATIONS! ğŸ‰"
    archLabel.TextColor3 = Color3.new(1, 1, 1)
    archLabel.TextScaled = true
    archLabel.Font = Enum.Font.SourceSansBold
    archLabel.Parent = archGui
    
    print("ğŸŸï¸ æ‹¡å¼µã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸï¼ˆ80x60ã‚¹ã‚¿ãƒƒãƒ‰ï¼‰")
    return goalFolder
end

-- ãƒ¡ã‚¤ãƒ³åˆæœŸåŒ–é–¢æ•°
function GoalAreaService.Initialize()
    if goalAreaInitialized then
        return
    end
    
    print("ğŸŸï¸ ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ä¸­...")
    
    -- MazeGameã®å¾…æ©Ÿ
    local mazeGame = workspace:WaitForChild("MazeGame", 30)
    if not mazeGame then
        warn("âŒ MazeGameãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return
    end
    
    -- æ‹¡å¼µã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢æ§‹ç¯‰
    buildExpandedGoalArea(mazeGame)
    
    goalAreaInitialized = true
    print("âœ… ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–å®Œäº†ï¼")
end

-- ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
function GoalAreaService.Start()
    spawn(function()
        wait(1) -- æ—©ã‚ã«æ§‹ç¯‰ï¼ˆä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚ˆã‚Šå‰ï¼‰
        GoalAreaService.Initialize()
    end)
end

return GoalAreaService