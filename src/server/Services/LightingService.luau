-- Kanata Maze ç…§æ˜ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆè‡ªå‹•é©ç”¨ç‰ˆï¼‰
local LightingService = {}

local workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")

-- ç…§æ˜åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
local lightingInitialized = false

-- ç’°å¢ƒå…‰è¨­å®šã®é©ç”¨ï¼ˆè‡ªç„¶å…‰é‡è¦–ã€çœ©ã—ã•è»½æ¸›ï¼‰
local function setupEnvironmentalLighting()
    Lighting.Ambient = Color3.new(0.4, 0.4, 0.5)  -- é©åº¦ãªç’°å¢ƒå…‰
    Lighting.Brightness = 2  -- æ¨™æº–çš„ãªæ˜ã‚‹ã•
    Lighting.OutdoorAmbient = Color3.new(0.6, 0.6, 0.7)  -- æ§ãˆã‚ãªå±‹å¤–å…‰
    Lighting.ColorShift_Bottom = Color3.new(0.3, 0.3, 0.4)
    Lighting.ColorShift_Top = Color3.new(0.8, 0.8, 0.9)
    Lighting.ShadowSoftness = 0.5
    Lighting.TimeOfDay = "14:00:00"  -- åˆå¾Œã®æŸ”ã‚‰ã‹ã„å…‰
    Lighting.GeographicLatitude = 30  -- å°‘ã—è§’åº¦ã‚’ã¤ã‘ãŸå¤ªé™½å…‰
    
    print("â˜€ï¸ è‡ªç„¶ãªç’°å¢ƒå…‰è¨­å®šã‚’é©ç”¨ã—ã¾ã—ãŸ")
end

-- ã‚¬ãƒ©ã‚¹ãƒ‘ãƒãƒ«ä½œæˆï¼ˆç…§æ˜ãªã—ã€ç´”ç²‹ãªã‚¬ãƒ©ã‚¹ã®ã¿ï¼‰
local function createGlassPanel(position, size, parent)
    local glassPanel = Instance.new("Part")
    glassPanel.Name = "GlassPanel"
    glassPanel.Size = size
    glassPanel.Position = position
    glassPanel.Anchored = true
    glassPanel.CanCollide = true
    glassPanel.Material = Enum.Material.Glass
    glassPanel.BrickColor = BrickColor.new("Institutional white")
    glassPanel.Transparency = 0.1  -- å°‘ã—è¦‹ãˆã‚‹ç¨‹åº¦
    glassPanel.Reflectance = 0.1  -- æ§ãˆã‚ãªåå°„
    glassPanel.Parent = parent
    
    return glassPanel
end

-- å‰Šé™¤ï¼šå¤©çª“ã¨è¿½åŠ ç…§æ˜ã¯ä¸è¦

-- ã‚¬ãƒ©ã‚¹å¤©äº•ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
local function buildGlassCeilingSystem(mazeGame)
    -- æ—¢å­˜ã®å¤©äº•ã¨ç…§æ˜ã‚’å‰Šé™¤
    local existingCeiling = mazeGame:FindFirstChild("Ceiling")
    if existingCeiling then
        existingCeiling:Destroy()
    end
    
    local existingLighting = mazeGame:FindFirstChild("Lighting")
    if existingLighting then
        existingLighting:Destroy()
    end
    
    local glassCeilingFolder = Instance.new("Folder")
    glassCeilingFolder.Name = "GlassCeiling"
    glassCeilingFolder.Parent = mazeGame
    
    local panelSize = 20
    local glassCount = 0
    
    -- è¿·è·¯ã‚¨ãƒªã‚¢ã®ã‚¬ãƒ©ã‚¹å¤©äº•ã®ã¿
    for x = -100, 100, panelSize do
        for z = -80, 80, panelSize do
            local glassPos = Vector3.new(x, 42, z)
            createGlassPanel(glassPos, Vector3.new(panelSize, 2, panelSize), glassCeilingFolder)
            glassCount = glassCount + 1
        end
    end
    
    -- ã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢ã®ã‚¬ãƒ©ã‚¹å¤©äº•
    for x = -50, 50, panelSize do
        for z = -140, -80, panelSize do
            local glassPos = Vector3.new(x, 42, z)
            createGlassPanel(glassPos, Vector3.new(panelSize, 2, panelSize), glassCeilingFolder)
            glassCount = glassCount + 1
        end
    end
    
    -- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®ã‚¬ãƒ©ã‚¹å¤©äº•
    for x = -40, 40, panelSize do
        for z = 80, 140, panelSize do
            local glassPos = Vector3.new(x, 42, z)
            createGlassPanel(glassPos, Vector3.new(panelSize, 2, panelSize), glassCeilingFolder)
            glassCount = glassCount + 1
        end
    end
    
    print("ğŸªŸ ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¬ãƒ©ã‚¹å¤©äº•ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸ: " .. glassCount .. " ãƒ‘ãƒãƒ«")
    return glassCeilingFolder
end

-- ãƒ¡ã‚¤ãƒ³åˆæœŸåŒ–é–¢æ•°
function LightingService.Initialize()
    if lightingInitialized then
        return
    end
    
    print("ğŸ’¡ ç…§æ˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ä¸­...")
    
    -- ç’°å¢ƒå…‰è¨­å®š
    setupEnvironmentalLighting()
    
    -- MazeGameã®å¾…æ©Ÿ
    local mazeGame = workspace:WaitForChild("MazeGame", 30)
    if not mazeGame then
        warn("âŒ MazeGameãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return
    end
    
    -- ã‚¬ãƒ©ã‚¹å¤©äº•ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰
    buildGlassCeilingSystem(mazeGame)
    
    lightingInitialized = true
    print("âœ… ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¬ãƒ©ã‚¹å¤©äº•ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–å®Œäº†ï¼")
end

-- ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
function LightingService.Start()
    spawn(function()
        wait(3) -- MazeGameã®æ§‹ç¯‰ã‚’å¾…ã¤
        LightingService.Initialize()
    end)
end

return LightingService