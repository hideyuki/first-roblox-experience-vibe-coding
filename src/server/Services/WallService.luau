-- Kanata Maze å£ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆéš™é–“ä¿®æ­£ç‰ˆï¼‰
local WallService = {}

local workspace = game:GetService("Workspace")

-- å£ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ•ãƒ©ã‚°
local wallSystemInitialized = false

-- å£ä½œæˆé–¢æ•°
local function createWall(position, size, name, parent)
    local wall = Instance.new("Part")
    wall.Name = name
    wall.Size = size
    wall.Position = position
    wall.Anchored = true
    wall.Material = Enum.Material.Brick
    wall.BrickColor = BrickColor.new("Dark stone grey")
    wall.Parent = parent
    
    return wall
end

-- ã‚¬ãƒ©ã‚¹å¤©äº•ãƒ‘ãƒãƒ«ä½œæˆ
local function createGlassCeiling(position, size, parent)
    local ceiling = Instance.new("Part")
    ceiling.Name = "GapCeiling"
    ceiling.Size = size
    ceiling.Position = position
    ceiling.Anchored = true
    ceiling.CanCollide = true
    ceiling.Material = Enum.Material.Glass
    ceiling.BrickColor = BrickColor.new("Institutional white")
    ceiling.Transparency = 0.1
    ceiling.Reflectance = 0.1
    ceiling.Parent = parent
    
    return ceiling
end

-- éš™é–“ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰
local function buildWallFixSystem(mazeGame)
    -- å£ãƒ•ã‚©ãƒ«ãƒ€ã®å–å¾—
    local wallsFolder = mazeGame:FindFirstChild("Walls")
    if not wallsFolder then
        wallsFolder = Instance.new("Folder")
        wallsFolder.Name = "Walls"
        wallsFolder.Parent = mazeGame
    end
    
    -- å•é¡Œã®ã‚ã‚‹æ—¢å­˜ã®å£ã‚’å‰Šé™¤
    local problematicWalls = {
        "StartGapWallLeft", "StartGapWallRight", 
        "StartAreaExtendedWallLeft", "StartAreaExtendedWallRight",
        "MazeTopOuterWall", "MazeTopOuterWallLeft", "MazeTopOuterWallRight"
    }
    
    for _, wallName in ipairs(problematicWalls) do
        local existingWall = wallsFolder:FindFirstChild(wallName)
        if existingWall then
            existingWall:Destroy()
        end
    end
    
    -- ã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢ã®éš™é–“ä¿®æ­£ï¼ˆå…¥å£ã‚’é–‹ã‘ã‚‹ãŸã‚èª¿æ•´ï¼‰
    createWall(Vector3.new(-50, 20, -81.5), Vector3.new(6, 40, 17), "StartGapWallLeft", wallsFolder)
    createWall(Vector3.new(50, 20, -81.5), Vector3.new(6, 40, 17), "StartGapWallRight", wallsFolder)
    
    -- ã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢å¤–å´ã®å£ï¼ˆå…¥å£ã‚’é–‹ã‘ã‚‹ãŸã‚çŸ­ç¸®ï¼‰
    createWall(Vector3.new(-65, 20, -115), Vector3.new(6, 40, 30), "StartAreaExtendedWallLeft", wallsFolder)  -- çŸ­ç¸®ï¼ˆz=-130ã€œ-100ï¼‰
    createWall(Vector3.new(65, 20, -115), Vector3.new(6, 40, 30), "StartAreaExtendedWallRight", wallsFolder)  -- çŸ­ç¸®ï¼ˆz=-130ã€œ-100ï¼‰
    
    -- ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®éš™é–“ä¿®æ­£
    createWall(Vector3.new(-50, 20, 79), Vector3.new(6, 40, 12), "GoalGapWallLeft", wallsFolder)
    createWall(Vector3.new(50, 20, 79), Vector3.new(6, 40, 12), "GoalGapWallRight", wallsFolder)
    createWall(Vector3.new(-65, 20, 110), Vector3.new(6, 40, 50), "GoalAreaExtendedWallLeft", wallsFolder)
    createWall(Vector3.new(65, 20, 110), Vector3.new(6, 40, 50), "GoalAreaExtendedWallRight", wallsFolder)
    
    -- è¿·è·¯å¤–å‘¨ã®å°é–ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢å…¥å£ã‚’é–‹ã‘ã‚‹ï¼‰
    createWall(Vector3.new(-110, 20, 0), Vector3.new(6, 40, 160), "MazeLeftOuterWall", wallsFolder)
    createWall(Vector3.new(110, 20, 0), Vector3.new(6, 40, 160), "MazeRightOuterWall", wallsFolder)
    
    -- è¿·è·¯ä¸Šå´ã®å£ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢å…¥å£ã®ãŸã‚ã«åˆ†å‰²ï¼‰
    createWall(Vector3.new(-75, 20, -85), Vector3.new(70, 40, 6), "MazeTopOuterWallLeft", wallsFolder)    -- å·¦å´éƒ¨åˆ†
    createWall(Vector3.new(75, 20, -85), Vector3.new(70, 40, 6), "MazeTopOuterWallRight", wallsFolder)    -- å³å´éƒ¨åˆ†
    -- ä¸­å¤®éƒ¨åˆ†ï¼ˆx=-40ã‹ã‚‰x=40ï¼‰ã¯é–‹ã‘ã¦ãŠãï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢ã¸ã®å…¥å£ï¼‰
    
    createWall(Vector3.new(0, 20, 85), Vector3.new(220, 40, 6), "MazeBottomOuterWall", wallsFolder)
    
    print("ğŸ§± ã‚¨ãƒªã‚¢é–“éš™é–“ä¿®æ­£å£ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸ")
    
    -- éš™é–“éƒ¨åˆ†ã®å¤©äº•è¿½åŠ 
    local glassCeilingFolder = mazeGame:FindFirstChild("GlassCeiling")
    if glassCeilingFolder then
        -- ã‚¹ã‚¿ãƒ¼ãƒˆã‚¨ãƒªã‚¢ã¨ã‚¹ã‚¿ãƒ¼ãƒˆã‚²ãƒ¼ãƒˆé–“ã®å¤©äº•
        for x = -60, 60, 20 do
            for z = -90, -70, 20 do
                createGlassCeiling(Vector3.new(x, 42, z), Vector3.new(20, 2, 20), glassCeilingFolder)
            end
        end
        
        -- ã‚´ãƒ¼ãƒ«ã‚²ãƒ¼ãƒˆã¨ã‚´ãƒ¼ãƒ«ã‚¨ãƒªã‚¢é–“ã®å¤©äº•
        for x = -60, 60, 20 do
            for z = 70, 90, 20 do
                createGlassCeiling(Vector3.new(x, 42, z), Vector3.new(20, 2, 20), glassCeilingFolder)
            end
        end
        
        print("ğŸ  éš™é–“éƒ¨åˆ†ã®ã‚¬ãƒ©ã‚¹å¤©äº•ã‚’è¿½åŠ ã—ã¾ã—ãŸ")
    end
end

-- ãƒ¡ã‚¤ãƒ³åˆæœŸåŒ–é–¢æ•°
function WallService.Initialize()
    if wallSystemInitialized then
        return
    end
    
    print("ğŸ§± å£ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ä¸­...")
    
    -- MazeGameã®å¾…æ©Ÿ
    local mazeGame = workspace:WaitForChild("MazeGame", 30)
    if not mazeGame then
        warn("âŒ MazeGameãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
        return
    end
    
    -- éš™é–“ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
    buildWallFixSystem(mazeGame)
    
    wallSystemInitialized = true
    print("âœ… å£ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–å®Œäº†ï¼")
end

-- ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
function WallService.Start()
    spawn(function()
        wait(4) -- ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã®å¾Œã«å®Ÿè¡Œ
        WallService.Initialize()
    end)
end

return WallService